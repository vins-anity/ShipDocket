services:
  # The Main API
  - type: web
    name: trail-api
    runtime: docker
    repo: https://github.com/YOUR_USERNAME/trail
    rootDir: .
    dockerfilePath: ./apps/api/Dockerfile
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: GEMINI_API_KEY
        sync: false
      - key: SLACK_CLIENT_ID
        sync: false
    startCommand: bun run start
    plan: free

  # The Background Worker (pg-boss)
  - type: worker
    name: trail-worker
    runtime: docker
    repo: https://github.com/YOUR_USERNAME/trail
    rootDir: .
    dockerfilePath: ./apps/api/Dockerfile
    envVars:
      - key: DATABASE_URL
        sync: false
    startCommand: bun run worker
    plan: free

  # The Frontend
  - type: static
    name: trail-web
    repo: https://github.com/vins-anity/trail
    rootDir: .
    buildCommand: bun install && bun run build:web
    publishDir: apps/web/dist
    envVars:
      - key: VITE_API_URL
        value: https://trail-api.onrender.com
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
